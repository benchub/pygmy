{% extends 'layout/base.html' %}
{% load static %}
{% block head_js %}
<!--<script src="{% static '/vendor/business-rules/conditions-builder.js' %}"></script>-->
<!--<script src="{% static '/vendor/business-rules/actions-builder.js' %}"></script>-->
<link rel="stylesheet" href="{% static '/vendor/flatpickr/css/flatpickr.min.css' %}" />
<script src="{% static '/vendor/flatpickr/js/flatpickr.min.js' %}"></script>
<script src="{% static '/js/ajax.autocomplete.js' %}"></script>
<script src="{% static '/vendor/cron/js/jqCron.js' %}"></script>
<script src="{% static '/vendor/cron/js/jqCron.en.js' %}"></script>
<link rel="stylesheet" href="{% static '/vendor/cron/css/jqCron.css' %}" />
{% endblock %}
{% block content %}
<style>
    .autocomplete-suggestions { border: 1px solid #999; background: #FFF; overflow: auto; }
    .autocomplete-suggestion { padding: 2px 5px; white-space: nowrap; overflow: hidden; }
    .autocomplete-selected { background: #F0F0F0; }
    .autocomplete-suggestions strong { font-weight: normal; color: #3399FF; }
    .autocomplete-group { padding: 2px 5px; }
    .autocomplete-group strong { display: block; border-bottom: 1px solid #000; }

    @media (min-width: 960px) {
        .1uk-form-horizontal .uk-form-label {
            width: 200px;
        }
        .1uk-form-horizontal .uk-form-controls {
            margin-left: 200px;
        }
    }

    .form-label {
        display: block;
        margin-bottom: 5px;
    }
</style>
<div class="content-padder content-background">
    <div class="uk-section-xsmall uk-section-default header">
        <div class="uk-container uk-container-large">
            <ul class="uk-breadcrumb">
                <li><a href="/">Home</a></li>
                <li><a href="{% url 'rules' %}">Rules</a></li>
                <li><span href="">new rule</span></li>
            </ul>
        </div>
    </div>
    <div class="uk-section-xsmall">
        <div class="uk-column-1-2" style="padding: 0px 20px">
        <h2>Create Rule</h2>
        </div>
    </div>
    <div class="uk-container uk-overflow-auto">
        {% if success %}
        <div class="uk-alert-success" style="max-width: 500px;" uk-alert>
            <a class="uk-alert-close" uk-close></a>
            <p><b>Success</b>! created rule successfully.</p>
        </div>
        {% elif error %}
        <div class="uk-alert-danger" style="max-width: 500px;" uk-alert>
            <a class="uk-alert-close" uk-close></a>
            <p><b>Failed</b>! {{error}}</p>
        </div>
        {% endif %}
        <form class="uk-form-horizontal" action="" method="post">
            {% csrf_token %}
            <table class="uk-table">
                <tr>
                    <td>
                        <div class="uk-margin">
                            <label class="uk-form-label uk-text-default" for="form-horizontal-select">Name</label>
                            <div class="uk-form-controls">
                                <input class="uk-input" name="name" type="text" placeholder="Rule Name..." value="{{data.name}}" required>
                            </div>
                        </div>
                        <hr>
                    </td>
                    <td>
                        <div class="uk-margin">
                            <label class="uk-form-label uk-text-default" for="form-horizontal-select">Cluster</label>
                            <div class="uk-form-controls">
                                <input class="uk-select cluster" name="cluster_name" type="text" placeholder="Cluster..." value="{{data.cluster_name}}" required>
                                <input id="cluster" name="cluster_id" type="hidden" value="{{data.cluster_id}}" required>
                            </div>
                        </div>
                        <hr>
                    </td>
                </tr>
                 <tr>
                    <td>
                        <div class="uk-margin">
                            <label class="uk-form-label uk-text-default" for="form-horizontal-select">Action</label>
                            <div class="uk-form-controls">
                                <select name="action" class="uk-select" id="form-horizontal-select">
                                    <option value="SCALE_DOWN" {% if data.action == "SCALE_DOWN"%}selected{% endif %}>Scale Down</option>
                                    <option value="SCALE_UP" {% if data.action == "SCALE_UP"%}selected{% endif %}>Scale Up</option>
                                </select>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="ec2_type_div" style="display:none">
                            <label class="uk-form-label uk-width-1-4 uk-text-default ">EC2 Instance Type</label>
                            <div class="uk-form-controls">
                                <input id="ec2_type" name="ec2_type" class="uk-select ec2_types" type="text" placeholder="EC2 types..." value="{{data.ec2_type}}">
                            </div>
                        </div>
                        <div id="rds_type_div" style="display:none">
                            <label class="uk-form-label uk-width-1-4 uk-text-default ">RDS Instance Type</label>
                            <div class="uk-form-controls">
                                <input id="rds_type" name="rds_type" class="uk-select rds_types" type="text" placeholder="RDS types..." value="{{data.rds_type}}">
                            </div>
                        </div>
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td>
                        <div class="uk-form-label uk-margin uk-grid-small uk-child-width-auto uk-grid">
                            <label class="uk-text-default">
                                <input id="enableTime" name="enableTime" class="uk-checkbox" type="checkbox"> Time
                            </label>
                        </div>
                        <div id="inputTime" class="uk-form-controls">
                            <div class="time_options">
                                <label><input class="typeTime uk-radio" type="radio" name="typeTime" value="daily" checked> Daily</label>
                                <label style="padding-left: 30px;"><input class="typeTime uk-radio" type="radio" name="typeTime" value="cron" style="align: right"> Cron</label>
                            </div>
                            <div id="check_daily_time_input" class="uk-margin">
                                <div>
                                    <input id="dailyTime" name="dailyTime" class="uk-input flatpickr" type="text" placeholder="Time..." value="{{data.time}}">
                                </div>
                            </div>
                            <div id="check_cron_time_input" class="uk-margin" style="display: none">
                                <div>
                                    <input id="cronTime" name="cronTime" class="uk-input crontime" type="text" placeholder="Time..." value="{{data.time}}">
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="uk-form-label uk-margin uk-grid-small uk-child-width-auto uk-grid">
                            <label class="uk-text-default">
                                <input id="enableReplicationLag" name="enableReplicationLag" class="uk-checkbox" type="checkbox"> Replication Lag
                            </label>
                        </div>
                        <div id="inputReplicationLag" class="uk-form-controls">
                            <select name="selectReplicationLagOp" class="uk-select uk-width-1-3" id="selectReplicationLagOp">
                                <option value="equal">equal</option>
                                <option value="less">less than</option>
                                <option value="greater">greater than</option>
                            </select>
                            <input id="replicationLag" name="replicationLag" class="uk-input uk-width-3-5" type="text" placeholder="Replication..." value="{{data.ec2_type}}">
                        </div>
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td>
                        <div class="uk-form-label uk-margin uk-grid-small uk-child-width-auto uk-grid">
                            <label class="uk-text-default">
                                <input id="enableCheckConnection" name="enableCheckConnection" class="uk-checkbox" type="checkbox"> Connections
                            </label>
                        </div>
                        <div id="inputCheckConnection" class="uk-form-controls">
                            <select name="selectCheckConnectionOp" class="uk-select uk-width-1-3" id="selectCheckConnectionOp">
                                <option value="equal">equal</option>
                                <option value="less">less than</option>
                                <option value="greater">greater than</option>
                            </select>
                            <input id="checkConnection" name="checkConnection" class="uk-input uk-width-3-5" type="text" placeholder="Connection..." value="{{data.checkConnection}}">
                        </div>
                    </td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: right;">
                        <button id="save_rule" class="uk-button uk-button-primary " type="submit">Create Rule</button>
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>
{% endblock %}
{% block js_bottom %}{{ block.super }}
<script>
{% if not success %}
var ec2_types = {{ ec2_types|safe }}
var rds_types = {{ rds_types|safe }}
var clusters = {{ clusters | safe }}
{% endif %}
$(document).ready(function() {
    {% if success %}
        window.location.href = "{% url 'rules' %}#ar";
    {% else %}
    $(".ec2_types").autocomplete({
      lookup: ec2_types,
      minChars: 0,
    });

    $(".rds_types").autocomplete({
      lookup: rds_types,
      minChars: 0,
    });

    $(".cluster").autocomplete({
      lookup: clusters,
      minChars: 0,
      onSelect: function (suggestion) {
        $("#cluster").val(suggestion.data);
        console.log("suggestion " + suggestion);
        $("#ec2_type_div").hide();
        $("#rds_type_div").hide();
        if(suggestion.type == "RDS")
            $("#rds_type_div").show();
        else
            $("#ec2_type_div").show();
      }
    });

    $(".flatpickr").flatpickr({
        enableTime: true,
        noCalendar: true,
        dateFormat: "H:i",
        time_24hr: false
    });
    $('.crontime').jqCron();
    {% endif %}

    // hide all inputs
    $("#inputTime").hide();
    $("#inputCheckConnection").hide();
    $("#inputReplicationLag").hide();
});

// Handle time check
$("#enableTime").change(function() {
   if(this.checked) {
        $("#inputTime").show();
   } else {
        $("#inputTime").hide();
   }
});

$("#enableCheckConnection").change(function() {
    if(this.checked) {
        $("#inputCheckConnection").show();
   } else {
        $("#inputCheckConnection").hide();
   }
});

$("#enableReplicationLag").change(function() {
    if(this.checked) {
        $("#inputReplicationLag").show();
   } else {
        $("#inputReplicationLag").hide();
   }
});

// Handle Replication Lag
$(".typeTime").change(function() {
    console.log("this ", this.value);
    if(this.value == "DAILY") {
        $("#check_cron_time_input").hide();
        $("#check_daily_time_input").show();
    } else {
        $("#check_cron_time_input").show();
        $("#check_daily_time_input").hide();
    }
});

// Handle

</script>
{% endblock %}